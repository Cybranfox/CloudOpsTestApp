<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: {{ lesson.title }} | AWS Orbit</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <h1>Quiz: {{ lesson.title }}</h1>
    </header>
    <main>
        <div class="card">
            <!-- Mascot and speech bubble -->
            <div class="mascot-container">
                <img id="zap-mascot" class="zap" src="{{ url_for('static', filename='zap.png') }}" alt="Zap Mascot">
                <div id="zap-speech" class="speech-bubble"></div>
            </div>
            {% if message %}
                <p><strong>{{ message|safe }}</strong></p>
                {% if repeat %}
                    <a class="btn" href="/quiz/{{ lesson.id }}">Try Again</a>
                {% else %}
                    {% if next_lesson_id %}
                        <a class="btn" href="/lesson/{{ next_lesson_id }}">Continue to Next Lesson →</a>
                    {% else %}
                        <a class="btn" href="/">← Back to Home</a>
                    {% endif %}
                {% endif %}
            {% else %}
                <div class="shields">
                    {% with prog = progress or {} %}
                    {% if prog.energy is defined %}
                        <strong>Shields:</strong> {{ prog.energy }} / 3
                    {% endif %}
                    {% endwith %}
                </div>
                <p>{{ lesson.question }}</p>
                <form method="post" class="question-form">
                    {% for option in lesson.options %}
                        <div>
                            {% if lesson.multi_select %}
                                <input type="checkbox" name="option" value="{{ option }}" id="{{ option }}">
                            {% else %}
                                <input type="radio" name="option" value="{{ option }}" id="{{ option }}" required>
                            {% endif %}
                            <label for="{{ option }}">{{ option }}</label>
                        </div>
                    {% endfor %}
                    <button class="btn" type="submit">Submit Answer</button>
                </form>
            {% endif %}
        </div>
    </main>
    <!-- Import the Zap animator as an ES module -->
    <script type="module">
      import ZapAnimator from "{{ url_for('static', filename='zap_animator.js') }}";
      const mascot = document.getElementById('zap-mascot');
      const speech = document.getElementById('zap-speech');
      const animator = new ZapAnimator(mascot, speech);
      // Determine reaction based on quiz outcome
      {% if message %}
        {% if correct %}
          animator.play('correct');
        {% else %}
          animator.play('wrong');
        {% endif %}
      {% endif %}
    </script>
</body>
</html>