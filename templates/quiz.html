{% extends "base.html" %}

{% block title %}Quiz - {{ lesson.title }}{% endblock %}

{% block content %}
<div class="mascot-container">
    <img src="{{ url_for('static', filename='zap.png') }}" alt="Zap" class="zap" id="zapMascot">
    <div class="speech-bubble" id="zapSpeech">
        {% if message %}{{ message }}{% else %}Ready for the challenge?{% endif %}
    </div>
</div>

<div class="room-type-indicator">
    {% if lesson.room_type == 'battle' %}⚔️ Battle Challenge
    {% elif lesson.room_type == 'elite' %}👑 Elite Challenge  
    {% elif lesson.room_type == 'boss' %}🐉 Boss Battle
    {% elif lesson.room_type == 'shop' %}🛒 Knowledge Shop
    {% elif lesson.room_type == 'event' %}🎲 Special Event
    {% else %}📚 Lesson
    {% endif %}
    - {{ lesson.difficulty.title() }}
</div>

<div class="energy-display">
    <strong>⚡ Energy Shields:</strong>
    <div class="shields">
        {% for i in range(progress.max_energy) %}
            {% if i < progress.energy %}
                <span class="shield-full">⚡</span>
            {% else %}
                <span class="shield-empty">⚡</span>
            {% endif %}
        {% endfor %}
    </div>
    <p><small>You lose 1 shield for wrong answers, gain 1 for correct answers!</small></p>
</div>

{% if correct is defined %}
    {% if correct %}
        <div class="result-section success">
            <h3>🎉 Victory Achieved!</h3>
            
            {% if lesson.explanation %}
                <div class="explanation-box">
                    <h4>💡 Explanation:</h4>
                    <p>{{ lesson.explanation }}</p>
                </div>
            {% endif %}
            
            {% if lesson.loot and lesson.room_type in ['elite', 'boss'] %}
                <div class="loot-box">
                    <h4>🎁 Loot Acquired!</h4>
                    <p><strong>{{ lesson.loot.name }}</strong>: {{ lesson.loot.description }}</p>
                </div>
            {% endif %}
            
            {% if lesson.badge %}
                <div class="badge-box">
                    <h4>🏆 Badge Earned!</h4>
                    <p>{{ lesson.badge }}</p>
                </div>
            {% endif %}
        </div>
    {% else %}
        <div class="result-section defeat">
            <h3>💔 Defeat... But Don't Give Up!</h3>
            
            {% if lesson.explanation %}
                <div class="explanation-box">
                    <h4>💡 Learn from this:</h4>
                    <p>{{ lesson.explanation }}</p>
                    <p><em>The correct answer was: {{ lesson.answer }}</em></p>
                </div>
            {% endif %}
        </div>
    {% endif %}
{% else %}
    {% if lesson.scenario %}
        <div class="scenario-box">
            <h3>🎯 Scenario</h3>
            <p>{{ lesson.scenario }}</p>
        </div>
    {% endif %}

    <div class="content-section">
        <h3>📋 Key Concepts</h3>
        <p>{{ lesson.content }}</p>
    </div>

    {% if lesson.loot %}
        <div class="loot-preview">
            <h4>🎁 Potential Reward</h4>
            <p><strong>{{ lesson.loot.name }}</strong>: {{ lesson.loot.description }}</p>
        </div>
    {% endif %}

    <div class="question-container">
        <form method="POST" class="quiz-form">
            <h3>{{ lesson.question }}</h3>
            
            <div class="options-container">
                {% if lesson.multi_select %}
                    {% for option in lesson.options %}
                        <label class="option-label multi-select">
                            <input type="checkbox" name="option" value="{{ option }}" class="option-input">
                            <span class="option-text">{{ option }}</span>
                        </label>
                    {% endfor %}
                    <p class="multi-select-hint"><em>Select all that apply</em></p>
                {% else %}
                    {% for option in lesson.options %}
                        <label class="option-label">
                            <input type="radio" name="option" value="{{ option }}" class="option-input" required>
                            <span class="option-text">{{ option }}</span>
                        </label>
                    {% endfor %}
                {% endif %}
            </div>
            
            <div class="quiz-actions">
                <button type="submit" class="btn btn-primary">⚔️ Submit Answer</button>
            </div>
        </form>
    </div>
{% endif %}

<div class="next-actions">
    {% if correct and next_lesson_id %}
        <a href="{{ url_for('lesson_page', lesson_id=next_lesson_id) }}" class="btn btn-primary">
            🚀 Next Adventure
        </a>
    {% elif not correct %}
        <a href="{{ url_for('quiz', lesson_id=lesson.id) }}" class="btn btn-secondary">
            🔄 Try Again
        </a>
    {% endif %}
    <a href="{{ url_for('home') }}" class="btn btn-secondary">
        🗺️ Return to Map
    </a>
</div>

<style>
.energy-display {
    text-align: center;
    margin: 20px 0;
    padding: 15px;
    background: rgba(var(--color-info-rgb), 0.1);
    border-radius: var(--radius-base);
    border: 2px solid rgba(var(--color-info-rgb), 0.3);
}

.shields {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: 10px 0;
}

.shield-full {
    color: #f7d51d;
    font-weight: bold;
    font-size: 1.5em;
    text-shadow: 0 0 5px rgba(247, 213, 29, 0.5);
    filter: drop-shadow(0 0 3px rgba(247, 213, 29, 0.8));
}

.shield-empty {
    color: #444;
    opacity: 0.4;
    font-size: 1.5em;
    filter: grayscale(100%);
}

.result-section {
    margin: 20px 0;
    padding: 20px;
    border-radius: var(--radius-base);
    text-align: center;
}

.result-section.success {
    background: rgba(var(--color-success-rgb), 0.1);
    border: 2px solid var(--color-success);
    color: var(--color-text);
}

.result-section.defeat {
    background: rgba(var(--color-error-rgb), 0.1);
    border: 2px solid var(--color-error);
    color: var(--color-text);
}

.explanation-box, .loot-box, .badge-box {
    margin: 15px 0;
    padding: 15px;
    background: rgba(var(--color-info-rgb), 0.1);
    border-radius: var(--radius-sm);
    border-left: 4px solid var(--color-primary);
}

.multi-select-hint {
    font-style: italic;
    color: var(--color-text-secondary);
    margin-top: 10px;
    text-align: center;
}
</style>

{% endblock %}